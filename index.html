<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<title>ComentaTuVida</title>
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
		<link rel="stylesheet" type="text/css" href="css/index.css">
		<script type="text/javascript" src="js/functions.js"></script>
	</head>
	<body>
		<header>
			<input type="checkbox" id="menu-toogle"/>
			<label for="menu-toogle"></label>
			<nav>
				<ul>
					<li><input type="text" name="buscar" value="" placeholder="Busqueda"/></li>
					<span class="loggedout">
						<li class="item"><a href="login.html"><i class="material-icons">person</i>Login</a></li>
						<li class="item"><a href="registro.html"><i class="material-icons">person_add</i>Registro</a></li>
					</span>
					<span class="loggedin">
						<li class="item"><a href="#"><i class="material-icons">cancel</i>LogOut</a></li>
						<li class="item"><a href="nueva-entrada.html"><i class="material-icons">add_circle</i>Nuevo</a></li>
					</span>
					<li class="info">
						<a href="index.html"><h1>ComentaTuVida</h1></a>
						<p>La web de comentarios lider.</p>
					</li>
					<li class="cat active"><a href="index.html">Inicio</a></li>
					<li class="cat"><a href="buscar.html">Buscar</a></li>
					<li class="cat loggedin"><a href="#">Perfil</a></li>
					<li class="cat"><a href="#">Categoria 1</a></li>
					<li class="cat"><a href="#">Categoria 2</a></li>
					<li class="cat"><a href="#">Categoria 3</a></li>
					<li class="cat"><a href="#">Categoria 4</a></li>
				</ul>
			</nav>
			<div class="logo">
				<a href="index.html"><img src="img/logo.png"></a>
			</div>
			<div class="headerinfo">
				<a href="index.html"><h1>ComentaTuVida</h1></a>
				<p>La web de comentarios lider.</p>
			</div>
			<div class="headerlinks">
				<span class="loggedout">
					<a href="login.html"><i class="material-icons">person</i>Login</a>
					<a href="registro.html"><i class="material-icons">person_add</i>Registro</a>
				</span>
				<span class="loggedin">
					<a href="#"><i class="material-icons">cancel</i>LogOut</a>
					<a href="nueva-entrada.html"><i class="material-icons">add_circle</i>Nuevo</a>
				</span>
			</div>
		</header>
		<main>
			<section class="articles">
				<h2>Ultimos artículos</h2>
				<div class="a-container">

				</div>
				<div class="a-pagination">
					
				</div>
				<template>
					<article>
						<div class="aheader">
							<a href=""><img src="" alt=""/></a>
						</div>
						<div class="abody">
							<a href=""><h3></h3></a>
							<p class="descripcion"></p>
						</div>
						<div class="afooter">
							<p class="autor"></p>
							<p class="numcom"></p>
							<p class="fecha"></p>
							<p class="numfotos"></p>
						</div>
					</article>
				</template>
			</section>
			<section class="c-section">
				<h2>Últimos comentarios</h2>
				<div class="comments">
				</div>
				<template>
					<div>
						<a href=""><h3></h3></a>
						<b></b>
						<p></p>
						<i class="autor"></i> - <i class="fecha"></i>
					</div>
				</template>
			</section>
		</main>
		<footer>
			<div>
				<h2>Información de contacto</h2>
				<p>
					<b>Nombre</b>: ComentaTuVida<br>
					<b>Telefono</b>: 695847362<br>
					<b>E-mail</b>: comentatuvida@comentala.com<br>
					<b>Dirección</b>: Calle falsa, 123, Madrid, España
				</p>
			</div>
			<div>
				<h2>Enlaces útiles</h2>
				<p>
					<a href="acerca.html">Acerca de ComentaTuVida</a>
					<a href="legal.html">Informacion legal</a>
					<a href="privacidad.html">Politica de privacidad</a>
					<a href="cookies.html">Politica de cookies</a>
				</p>
			</div>
			<p><b>&copy;2017 - ComentaTuVida</b></p>
		</footer>
		<script>
			var nEntradas = 6;
			var nPagina = 1;
			var nComentarios = 10;
			ajaxGetRequest("rest/entrada/?u="+nEntradas, function(res){
				let entradas = document.querySelectorAll('.a-container article')
				for (let entrada of entradas){
					entrada.remove();
				}
				let plantilla = document.querySelector('.articles template');
				for (let fila of res.FILAS){
					let elem = plantilla.content.cloneNode(true);
                
	                elem.querySelector('.aheader a').href = 'http://localhost/practica2/entradas.html?id='+fila.id;
	                elem.querySelector('.aheader img').src = 'http://localhost/practica2/fotos/'+fila.fichero;
	                elem.querySelector('.aheader img').alt = 'http://localhost/practica2/fotos/'+fila.nombre;
	                elem.querySelector('.abody a').href = 'http://localhost/practica2/entradas.html?id='+fila.id;
					elem.querySelector('.abody h3').innerHTML = fila.nombre;
					elem.querySelector('.abody .descripcion').innerHTML = fila.descripcion;
					elem.querySelector('.afooter .autor').innerHTML = fila.login;
					elem.querySelector('.afooter .numcom').innerHTML = fila.ncomentarios;
					elem.querySelector('.afooter .numfotos').innerHTML = fila.nfotos;
					elem.querySelector('.afooter .fecha').innerHTML = fila.fecha;

	                document.querySelector('.a-container').appendChild(elem);
				}
				if (nPagina > 1){
					document.querySelector('.a-pagination').innerHTML = '<a href="#">&lt;&lt;</a><a href="#">&lt;</a><b>'+nPagina+' de 12</b><a href="#">&gt;</a><a href="#">&gt;&gt;</a>';
				} else {
					document.querySelector('.a-pagination').innerHTML = '<b>'+nPagina+' de 12</b><a href="#">&gt;</a><a href="#">&gt;&gt;</a>';
				}
			});
			ajaxGetRequest("rest/comentario/?u="+nComentarios, function(res){
				let comentarios = document.querySelectorAll('.comments div')
				for (let comentario of comentarios){
					comentario.remove();
				}
				let plantilla = document.querySelector('.c-section>template');
				for (let fila of res.FILAS){
					let elem = plantilla.content.cloneNode(true);
					elem.querySelector('a').href='http://localhost/practica2/entradas.html?id='+fila.id+"#comments";
					elem.querySelector('h3').innerHTML=fila.titulo; //ToDo: Aqui titulo del post
					elem.querySelector('b').innerHTML=fila.titulo;
					elem.querySelector('p').innerHTML=fila.texto;
					elem.querySelector('i.autor').innerHTML=fila.login;
					elem.querySelector('i.fecha').innerHTML=fila.fecha;
	                document.querySelector('.comments').appendChild(elem);
				}
			});
			//sessionStorage.setItem("login", "false");
			if (sessionStorage.getItem("login") == "true"){
				var items = document.querySelectorAll(".loggedin");
				for (var item of items){
					item.style.display = "block";
				}
				var items = document.querySelectorAll(".loggedout");
				for (var item of items){
					item.style.display = "none";
				}
			} else {
				var items = document.querySelectorAll(".loggedin");
				for (var item of items){
					item.style.display = "none";
				}
				var items = document.querySelectorAll(".loggedout");
				for (var item of items){
					item.style.display = "block";
				}
			}
		</script>
	</body>
</html>